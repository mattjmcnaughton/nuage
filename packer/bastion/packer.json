{
  "builders": [{
    "type": "vagrant",
    "communicator": "ssh",
    "source_path": "../base/output-vagrant/package.box",
    "box_name": "_tmp_",
    "provider": "virtualbox",
    "teardown_method": "destroy",
    "add_force": true,
    "skip_package": true
  }, {
    "type": "amazon-ebs",
    "region": "us-east-1",
    "source_ami_filter": {
      "filters": {
        "name": "base-*",
        "virtualization-type": "hvm",
        "root-device-type": "ebs"
      },
      "owners": ["073182613561"],
      "most_recent": true
    },
    "instance_type": "m3.medium",
    "ssh_username": "ubuntu",
    "ami_name": "bastion-{{isotime | clean_resource_name}}",
    "tags": {
      "project": "nuage",
      "Name": "bastion-{{isotime | clean_resource_name}}",
      "name": "bastion-{{isotime | clean_resource_name}}",
      "fullname": "bastion-{{isotime | clean_resource_name}}",
      "base_image_ami": "{{ .SourceAMI }}",
      "base_image_name": "{{ .SourceAMIName }}",
      "date": "{{isotime | clean_resource_name}}"
    }
  }],
  "provisioners": [{
    "type": "ansible",
    "playbook_file": "./playbook.yml",
    "ansible_env_vars": [
      "ANSIBLE_ROLES_PATH=../share/roles"
    ]
  }, {
    "type": "inspec",
    "extra_arguments": ["--no-distinct-exit"],
    "profile": "../share/tests/linux-baseline"
  }, {
    "type": "inspec",
    "extra_arguments": ["--no-distinct-exit"],
    "profile": "../share/roles/mattjmcnaughton.entropy-generator/test/integration/default/"
  }, {
    "type": "inspec",
    "extra_arguments": ["--no-distinct-exit"],
    "profile": "../share/roles/mattjmcnaughton.system-security-updates/test/integration/default/"
  }, {
    "type": "inspec",
    "extra_arguments": ["--no-distinct-exit"],
    "profile": "../share/roles/mattjmcnaughton.ssh-hardening-lite/test/integration/default/"
  }, {
    "type": "inspec",
    "extra_arguments": ["--no-distinct-exit"],
    "profile": "../share/roles/mattjmcnaughton.bastion/test/integration/default/"
  }]
}
